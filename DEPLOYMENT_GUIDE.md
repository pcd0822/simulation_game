# Google Apps Script 배포 가이드

## CORS 문제 해결을 위한 배포 설정

### 1. 코드 확인
- `Code.gs` 파일이 올바르게 저장되었는지 확인
- `doPost`와 `doGet` 함수가 모두 있는지 확인

### 2. 웹 앱으로 배포

#### 배포 방법:
1. Google Apps Script 편집기에서 **"배포"** → **"새 배포"** 클릭
2. 설정:
   - **유형 선택**: "웹 앱" 선택
   - **설명**: 원하는 설명 입력 (예: "게임 데이터 저장/불러오기")
   - **실행 사용자**: **"나"** 선택 (중요!)
   - **액세스 권한**: **"모든 사용자"** 선택 (중요!)
3. **"배포"** 버튼 클릭
4. **권한 승인**: 처음 배포 시 권한 승인 필요
5. **웹 앱 URL 복사**: 배포된 URL을 `.env` 파일의 `VITE_GOOGLE_SCRIPT_URL`에 설정

### 3. 배포 설정 확인

배포 후 다음을 확인하세요:

#### 배포 URL 형식:
```
https://script.google.com/macros/s/[DEPLOYMENT_ID]/exec
```

#### 중요 사항:
- URL 끝에 `/exec`가 있어야 합니다
- `/dev`가 아닌 `/exec`를 사용해야 합니다
- 배포를 수정할 때마다 새 버전을 배포해야 할 수 있습니다

### 4. 권한 설정

#### 시트 공유 설정:
1. 사용자의 Google 시트 열기
2. **"공유"** 버튼 클릭
3. **"링크가 있는 모든 사용자"** 또는 **"편집 권한"** 설정
4. 또는 Google Apps Script를 실행하는 계정에 편집 권한 부여

### 5. 테스트

#### 배포 테스트:
1. 브라우저에서 배포 URL 직접 접속
2. `{"status":"error","message":"targetSheetUrl 파라미터가 필요합니다."}` 같은 응답이 오면 정상
3. CORS 오류가 나오면 배포 설정을 다시 확인

### 6. 문제 해결

#### CORS 오류가 계속 발생하는 경우:

1. **새 배포 생성**:
   - 기존 배포를 수정하지 말고 **"새 배포"** 생성
   - 새 URL이 생성되므로 `.env` 파일 업데이트

2. **배포 버전 확인**:
   - 배포 관리에서 최신 버전이 배포되었는지 확인
   - 필요시 "새 버전"으로 배포

3. **권한 재승인**:
   - 배포 → 배포 관리 → 권한 승인
   - 모든 권한을 다시 승인

4. **시트 접근 권한**:
   - Google Apps Script를 실행하는 계정이 시트에 접근할 수 있는지 확인
   - 시트를 공유하거나 계정에 권한 부여

### 7. 디버깅

#### 로그 확인:
1. Google Apps Script 편집기에서 **"실행"** → **"doPost 테스트"**
2. 또는 **"보기"** → **"실행 기록"**에서 오류 확인

#### 프론트엔드 디버깅:
1. 브라우저 개발자 도구(F12) → Network 탭
2. 요청 URL과 응답 확인
3. CORS 오류가 있는지 확인

## 참고사항

- Google Apps Script Web App은 배포 시 자동으로 CORS를 처리합니다
- `setHeaders()` 메서드는 ContentService에서 지원하지 않습니다
- 배포 URL은 변경되지 않지만, 새 배포를 만들면 새 URL이 생성됩니다
- 로컬 저장은 항상 작동하므로, Google Script 저장이 실패해도 게임은 정상 작동합니다
